<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkHub - æ™ºèƒ½ä¹¦ç­¾ç®¡ç†</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }

        .user-menu {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-secondary:hover {
            background: #e5e7eb;
        }

        .search-bar {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .controls {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-select {
            padding: 8px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            background: white;
        }

        .view-toggle {
            display: flex;
            gap: 4px;
            background: #f3f4f6;
            padding: 4px;
            border-radius: 8px;
        }

        .view-btn {
            padding: 8px 12px;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            transition: background 0.3s;
        }

        .view-btn.active {
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .categories-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
        }

        .categories-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .category-tag {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }

        .category-tag:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .category-tag.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .category-count {
            margin-left: 4px;
            opacity: 0.7;
        }

        .bookmarks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .bookmark-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            cursor: pointer;
        }

        .bookmark-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .bookmark-icon {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 12px;
        }

        .bookmark-content {
            flex: 1;
        }

        .bookmark-title {
            font-size: 16px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 8px;
            text-decoration: none;
            display: block;
        }

        .bookmark-title:hover {
            color: #667eea;
        }

        .bookmark-desc {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .bookmark-meta {
            display: flex;
            gap: 16px;
            font-size: 13px;
            color: #6b7280;
            margin-bottom: 12px;
        }

        .bookmark-actions {
            display: flex;
            gap: 8px;
            padding-top: 12px;
            border-top: 1px solid #f3f4f6;
        }

        .action-btn {
            flex: 1;
            padding: 8px;
            border: none;
            background: #f9fafb;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            transition: background 0.3s;
        }

        .action-btn:hover {
            background: #f3f4f6;
        }

        .pagination {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pagination-info {
            color: #6b7280;
            font-size: 14px;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
        }

        .page-btn {
            padding: 8px 16px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) {
            border-color: #667eea;
            color: #667eea;
        }

        .page-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .page-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="header-top">
                <div class="logo">ğŸ”— LinkHub</div>
                <div class="user-menu">
                    <button class="btn btn-secondary" onclick="window.location.href='/login.html'">ç™»å½•</button>
                    <button class="btn btn-primary" onclick="window.location.href='/signup.html'">æ³¨å†Œ</button>
                </div>
            </div>

            <!-- æœç´¢æ  -->
            <div class="search-bar">
                <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢ä¹¦ç­¾åç§°æˆ–æè¿°...">
                <button class="btn btn-primary" onclick="searchBookmarks()">ğŸ” æœç´¢</button>
            </div>

            <!-- æ’åºå’Œè§†å›¾ -->
            <div class="controls">
                <select class="control-select" id="sortSelect" onchange="loadBookmarks()">
                    <option value="created_at">æŒ‰åˆ›å»ºæ—¶é—´</option>
                    <option value="last_visit_at">æŒ‰è®¿é—®æ—¶é—´</option>
                    <option value="visit_count">æŒ‰è®¿é—®æ¬¡æ•°</option>
                    <option value="title">æŒ‰åç§°</option>
                </select>
                <select class="control-select" id="pageSizeSelect" onchange="loadBookmarks()">
                    <option value="12">12 æ¡/é¡µ</option>
                    <option value="24">24 æ¡/é¡µ</option>
                    <option value="48">48 æ¡/é¡µ</option>
                </select>
                <div class="view-toggle">
                    <button class="view-btn active">â–  ç½‘æ ¼</button>
                    <button class="view-btn">â˜° åˆ—è¡¨</button>
                </div>
            </div>
        </div>

        <!-- åˆ†ç±»åŒºåŸŸ -->
        <div class="categories-section">
            <h3 class="section-title">åˆ†ç±»</h3>
            <div class="categories-tags" id="categoriesTags">
                <!-- åˆ†ç±»æ ‡ç­¾é€šè¿‡ JS åŠ¨æ€åŠ è½½ -->
            </div>
        </div>

        <!-- ä¹¦ç­¾åŒºåŸŸ -->
        <div class="bookmarks-grid" id="bookmarksGrid">
            <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: #6b7280;">
                <div style="font-size: 48px; margin-bottom: 16px;">â³</div>
                <div style="font-size: 18px;">åŠ è½½ä¸­...</div>
            </div>
        </div>

        <!-- åˆ†é¡µ -->
        <div class="pagination" id="pagination">
            <div class="pagination-info" id="paginationInfo">æ˜¾ç¤º 0-0 æ¡ï¼Œå…± 0 æ¡</div>
            <div class="pagination-controls" id="paginationControls"></div>
        </div>
    </div>

    <script src="./js/api.js"></script>
    <script>
    // è®¿å®¢æ¨¡å¼çš„ç®€åŒ–çŠ¶æ€ç®¡ç†
    const state = {
        bookmarks: [],
        categories: [],
        currentCategoryId: null,
        searchQuery: '',
        sortBy: 'created_at',
        order: 'desc',
        page: 1,
        pageSize: 12,
        total: 0
    };

    // åŠ è½½åˆ†ç±»ï¼ˆè®¿å®¢æ¨¡å¼ï¼‰
    async function loadCategories() {
        try {
            const categories = await API.getCategories();
            state.categories = categories;
            renderCategories();
        } catch (error) {
            console.error('åŠ è½½åˆ†ç±»å¤±è´¥:', error);
        }
    }

    // æ¸²æŸ“åˆ†ç±»æ ‡ç­¾
    function renderCategories() {
        const container = document.getElementById('categoriesTags');
        container.innerHTML = state.categories.map(cat => `
            <span class="category-tag ${!state.currentCategoryId && cat.name === 'å…¨éƒ¨' || state.currentCategoryId === cat.id ? 'active' : ''}"
                  onclick="filterByCategory(${cat.id})"
                  style="border-color: ${cat.color}; ${state.currentCategoryId === cat.id ? `background: ${cat.color}20;` : ''}">
                ${cat.icon} ${cat.name}
                <span class="category-count">(${cat.bookmark_count || 0})</span>
            </span>
        `).join('');
    }

    // æŒ‰åˆ†ç±»ç­›é€‰
    function filterByCategory(categoryId) {
        const category = state.categories.find(c => c.id === categoryId);
        if (category && category.name === 'å…¨éƒ¨') {
            state.currentCategoryId = null;
        } else {
            state.currentCategoryId = categoryId;
        }
        state.page = 1;
        loadBookmarks();
    }

    // æœç´¢ä¹¦ç­¾
    function searchBookmarks() {
        state.searchQuery = document.getElementById('searchInput').value;
        state.page = 1;
        loadBookmarks();
    }

    // åŠ è½½ä¹¦ç­¾ï¼ˆè®¿å®¢æ¨¡å¼ï¼‰
    async function loadBookmarks() {
        try {
            const sortBy = document.getElementById('sortSelect')?.value || state.sortBy;
            const pageSize = parseInt(document.getElementById('pageSizeSelect')?.value || state.pageSize);

            state.sortBy = sortBy;
            state.pageSize = pageSize;

            const params = {
                category_id: state.currentCategoryId,
                search: state.searchQuery,
                sort_by: state.sortBy,
                order: state.order,
                page: state.page,
                page_size: state.pageSize
            };

            const response = await API.getBookmarks(params);
            state.bookmarks = response.items;
            state.total = response.total;

            renderBookmarks();
            renderPagination();
        } catch (error) {
            console.error('åŠ è½½ä¹¦ç­¾å¤±è´¥:', error);
            document.getElementById('bookmarksGrid').innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: #ef4444;">
                    <div style="font-size: 48px; margin-bottom: 16px;">âŒ</div>
                    <div style="font-size: 18px;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</div>
                </div>
            `;
        }
    }

    // æ¸²æŸ“ä¹¦ç­¾
    function renderBookmarks() {
        const container = document.getElementById('bookmarksGrid');

        if (state.bookmarks.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px; color: #6b7280;">
                    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ“­</div>
                    <div style="font-size: 18px;">æš‚æ— ä¹¦ç­¾</div>
                    <button class="btn btn-primary" style="margin-top: 20px;" onclick="window.location.href='/login.html'">
                        ç™»å½•åæ·»åŠ ä¹¦ç­¾
                    </button>
                </div>
            `;
            return;
        }

        container.innerHTML = state.bookmarks.map(bookmark => `
            <div class="bookmark-card">
                <div class="bookmark-icon">${bookmark.icon || 'ğŸ”—'}</div>
                <div class="bookmark-content">
                    <a href="${bookmark.url}" target="_blank" class="bookmark-title" title="${bookmark.title}">
                        ${bookmark.title || bookmark.name || 'æœªå‘½å'}
                    </a>
                    <p class="bookmark-desc">${bookmark.description || 'æš‚æ— æè¿°'}</p>
                    <div class="bookmark-meta">
                        <span>ğŸ‘ ${bookmark.visit_count || bookmark.click_count || 0} æ¬¡</span>
                        <span>â° ${bookmark.last_visit_at || bookmark.last_accessed ? 'ä»æœª' : 'ä»æœª'}</span>
                    </div>
                </div>
                <div class="bookmark-actions">
                    <button class="action-btn" onclick="window.open('${bookmark.url}', '_blank')" title="è®¿é—®">
                        ğŸ”— è®¿é—®
                    </button>
                </div>
            </div>
        `).join('');
    }

    // æ¸²æŸ“åˆ†é¡µ
    function renderPagination() {
        const totalPages = Math.ceil(state.total / state.pageSize);
        const start = (state.page - 1) * state.pageSize + 1;
        const end = Math.min(state.page * state.pageSize, state.total);

        document.getElementById('paginationInfo').textContent =
            `æ˜¾ç¤º ${start}-${end} æ¡ï¼Œå…± ${state.total} æ¡`;

        const controls = document.getElementById('paginationControls');
        controls.innerHTML = `
            <button class="page-btn" ${state.page === 1 ? 'disabled' : ''} onclick="changePage(${state.page - 1})">ä¸Šä¸€é¡µ</button>
            ${Array.from({length: Math.min(5, totalPages)}, (_, i) => {
                const page = i + 1;
                return `<button class="page-btn ${page === state.page ? 'active' : ''}" onclick="changePage(${page})">${page}</button>`;
            }).join('')}
            <button class="page-btn" ${state.page === totalPages ? 'disabled' : ''} onclick="changePage(${state.page + 1})">ä¸‹ä¸€é¡µ</button>
        `;
    }

    // åˆ‡æ¢é¡µç 
    function changePage(page) {
        state.page = page;
        loadBookmarks();
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
        loadCategories();
        loadBookmarks();
    });
    </script>
</body>
</html>